# aimai-js

[![npm version](https://badge.fury.io/js/aimaijs.svg)](https://badge.fury.io/js/aimaijs) <!-- TODO: Replace 'aimaijs' with your actual npm package name -->
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) <!-- Or Apache-2.0 -->
<!-- Add more badges if you like (e.g., build status, coverage) -->

**æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã®ãŸã‚ã®é«˜æ©Ÿèƒ½ãªæ›–æ˜§æ¤œç´¢ (Fuzzy Search) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**

`aimai.js` ã¯ã€æ—¥æœ¬èªã®ç‰¹æ€§ã‚’è€ƒæ…®ã—ãŸæ›–æ˜§æ¤œç´¢æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ Node.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
[Fuse.js](https://fusejs.io/) ã®ã‚ˆã†ãªæ—¢å­˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚Œã¤ã¤ã€ä»¥ä¸‹ã®æ—¥æœ¬èªç‰¹æœ‰ã®èª²é¡Œã«å¯¾å¿œã—ã¾ã™ã€‚

* **è¡¨è¨˜æºã‚Œå¸å:** ã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€åŠè§’ã‚«ãƒŠã€å…¨è§’/åŠè§’è‹±æ•°å­—è¨˜å·ã‚’åŒä¸€è¦–ã—ã¦æ¤œç´¢ã—ã¾ã™ã€‚
* **èª­ã¿ä»®åæ¤œç´¢:** æ¼¢å­—ã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€ãã®èª­ã¿ä»®åï¼ˆã²ã‚‰ãŒãªï¼‰ã§ã‚‚æ¤œç´¢ã§ãã¾ã™ (å†…éƒ¨ã§ [Kuromoji.js](https://github.com/takuyaa/kuromoji.js) ã‚’ä½¿ç”¨)ã€‚
* **é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³:**
  * æ¤œç´¢çµæœã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºç”¨æƒ…å ±ã®æä¾›
  * ãƒ­ãƒ¼ãƒå­—å…¥åŠ›ã«ã‚ˆã‚‹æ¤œç´¢
  * å˜èªå˜ä½ã§ã®æ¤œç´¢ (äºˆå®š)
  * ç•°ä½“å­—ãƒ»æ—§å­—ä½“ã®æ­£è¦åŒ– (äºˆå®š)

## âœ¨ ç‰¹å¾´ (Features)

* **æ—¥æœ¬èªã«æœ€é©åŒ–:** ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠ/åŠè§’ã‚«ãƒŠã®å·®ç•°ã€èª­ã¿ä»®åã‚’å¸åã€‚
* **å¼·åŠ›ãªæ›–æ˜§æ¤œç´¢:** [Levenshteinè·é›¢](https://ja.wikipedia.org/wiki/%E3%83%AC%E3%83%BC%E3%83%99%E3%83%B3%E3%82%B7%E3%83%A5%E3%82%BF%E3%82%A4%E3%83%B3%E8%B7%9D%E9%9B%A2) (`fastest-levenshtein` ã‚’åˆ©ç”¨) ã«åŸºã¥ãã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã€‚
* **äº‹å‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–:** `kuromoji.js` ã‚’åˆ©ç”¨ã—ãŸèª­ã¿ä»®åå–å¾—ã¨æ­£è¦åŒ–ã‚’äº‹å‰ã«è¡Œã„ã€è»½é‡ãªJSONã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ¤œç´¢æ™‚ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå¤§å¹…ã«å‘ä¸Šã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ãŒé™ã‚‰ã‚ŒãŸç’°å¢ƒã§ã‚‚é«˜é€Ÿã«å‹•ä½œã—ã¾ã™ã€‚
* **æŸ”è»Ÿãªæ¤œç´¢å¯¾è±¡:** å…ƒã®ãƒ‡ãƒ¼ã‚¿ãŒæ–‡å­—åˆ—é…åˆ—ã§ã‚‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã§ã‚‚ã€ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦æ¤œç´¢å¯èƒ½ã€‚
* **è»½é‡ï¼†é«˜é€Ÿ:** æ¤œç´¢å‡¦ç†è‡ªä½“ã¯è»½é‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚
* **TypeScriptãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼:** å®Œå…¨ãªå‹å®šç¾©ã‚’æä¾›ã€‚

## âš ï¸ é‡è¦: äº‹å‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆ

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€æœ€é«˜ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¾—ã‚‹ãŸã‚ã«ã€æ¤œç´¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã® **äº‹å‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆ** ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚`kuromoji.js` ã«ã‚ˆã‚‹æ—¥æœ¬èªã®è§£æï¼ˆèª­ã¿ä»®åå–å¾—ï¼‰ã¯æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚ã€æ¤œç´¢æ™‚ã«æ¯å›è¡Œã†ã®ã§ã¯ãªãã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚„ãƒ‡ãƒ¼ã‚¿æº–å‚™æ®µéšã§ä¸€åº¦ã ã‘å®Ÿè¡Œã—ã¾ã™ã€‚

1. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ:**
   * ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ JavaScript ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ (`yarn build` ã‚„ `npm run build` ãªã©)ã€‚
   * æ¬¡ã«ã€æä¾›ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

   ```bash
   # ä¾‹: data/my_list.json ã‹ã‚‰ data/my_index.json ã‚’ç”Ÿæˆ
   # æ–‡å­—åˆ—é…åˆ—ã®å ´åˆ
   yarn generate:index --input=./data/my_list.json --output=./data/my_index.json

   # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã§ 'title' ã‚­ãƒ¼ã‚’å¯¾è±¡ã¨ã™ã‚‹å ´åˆ
   yarn generate:index --input=./data/my_objects.json --output=./data/my_index.json --key=title
   ```

   * `--input`: å…ƒã®ãƒ‡ãƒ¼ã‚¿ (JSONé…åˆ—) ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹ã€‚
   * `--output`: ç”Ÿæˆã•ã‚Œã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ« (JSON) ã®å‡ºåŠ›ãƒ‘ã‚¹ã€‚
   * `--key` (ã‚ªãƒ—ã‚·ãƒ§ãƒ³): å…¥åŠ›ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã®å ´åˆã€æ¤œç´¢å¯¾è±¡ã¨ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã‚‹ã‚­ãƒ¼åã€‚

2. **ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½¿ç”¨:**
   ç”Ÿæˆã•ã‚ŒãŸ `my_index.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«èª­ã¿è¾¼ã¿ã€`Aimai` ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«æ¸¡ã—ã¾ã™ã€‚

## ğŸ’¿ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (Installation)

```bash
yarn add aimaijs
# or
npm install aimaijs

# kuromoji.js ã‚‚å¿…è¦ã§ã™ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆæ™‚ã«ä½¿ç”¨)
yarn add kuromoji
# or
npm install kuromoji
```

## ğŸš€ ä½¿ã„æ–¹ (Usage)

### ã‚¹ãƒ†ãƒƒãƒ— 1: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™

ä¸Šè¨˜ã€Œäº‹å‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å¾“ã£ã¦ã€æ¤œç´¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹: `indexedData.json`ï¼‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

`indexedData.json` ã®ä¾‹:

```json
[
  {
    "original": "æ±äº¬éƒ½",
    "normalized": "ã¨ã†ãã‚‡ã†ã¨", // normalize() é©ç”¨å¾Œ
    "reading": "ã¨ã†ãã‚‡ã†ã¨"     // getReading() -> normalize() é©ç”¨å¾Œ
  },
  {
    "original": "ã¨ã†ãã‚‡ã†ã¨",
    "normalized": "ã¨ã†ãã‚‡ã†ã¨",
    "reading": "ã¨ã†ãã‚‡ã†ã¨"
  },
  {
    "original": "ãƒˆã‚¦ã‚­ãƒ§ã‚¦ãƒˆ",
    "normalized": "ã¨ã†ãã‚‡ã†ã¨",
    "reading": "ã¨ã†ãã‚‡ã†ã¨"
  },
  // ... more items
]
```

### ã‚¹ãƒ†ãƒƒãƒ— 2: Aimai ã‚’ä½¿ã£ãŸæ¤œç´¢

```typescript
import Aimai from 'aimaijs';
// import { IndexedItem } from 'aimaijs/dist/types'; // å‹å®šç¾©ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å ´åˆ

// äº‹å‰ã«ç”Ÿæˆã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ (Node.js ã®ä¾‹)
import * as fs from 'fs';
const indexedData = JSON.parse(fs.readFileSync('./data/indexedData.json', 'utf-8'));
// ãƒ–ãƒ©ã‚¦ã‚¶ã®å ´åˆã¯ fetch ãªã©ã§èª­ã¿è¾¼ã‚€

// 1. Aimaiã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™)
const aimai = new Aimai(indexedData, { /* ã‚ªãƒ—ã‚·ãƒ§ãƒ³ */ });

// 2. æ¤œç´¢ã‚’å®Ÿè¡Œ
const results1 = await aimai.search('ã¨ã†ãã‚‡ã†'); // æ¤œç´¢ã‚¯ã‚¨ãƒªã¯å†…éƒ¨ã§æ­£è¦åŒ–ã•ã‚Œã‚‹
console.log(results1);
/*
[
  // çµæœã¯ original ã®å€¤ã‚’å«ã‚€
  { item: 'æ±äº¬éƒ½', score: 1, refIndex: 0 },
  { item: 'ã¨ã†ãã‚‡ã†ã¨', score: 1, refIndex: 1 },
  { item: 'ãƒˆã‚¦ã‚­ãƒ§ã‚¦ãƒˆ', score: 1, refIndex: 2 },
  // ...
]
*/

const results2 = await aimai.search('kyoto'); // ãƒ­ãƒ¼ãƒå­—æ¤œç´¢ã‚‚å¯èƒ½ (useRomajiSearch: true ã®å ´åˆ)
console.log(results2);
/*
[
  // äº¬éƒ½é–¢é€£ã®çµæœ
]
*/

// --- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã‹ã‚‰ç”Ÿæˆã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å ´åˆ ---
// indexedBooks.json ã®ä¾‹:
// [
//   { "original": { "title": "èµ°ã‚Œãƒ¡ãƒ­ã‚¹", "author": "å¤ªå®°æ²»" }, "normalized": "ã¯ã—ã‚Œã‚ã‚ã™ ã ã–ã„ãŠã•ã‚€", "reading": "ã¯ã—ã‚Œã‚ã‚ã™ ã ã–ã„ãŠã•ã‚€" },
//   { "original": { "title": "äººé–“å¤±æ ¼", "author": "å¤ªå®°æ²»" }, "normalized": "ã«ã‚“ã’ã‚“ã—ã£ã‹ã ã ã–ã„ãŠã•ã‚€", "reading": "ã«ã‚“ã’ã‚“ã—ã£ã‹ã ã ã–ã„ãŠã•ã‚€" },
//   ...
// ]
const indexedBooks = JSON.parse(fs.readFileSync('./data/indexedBooks.json', 'utf-8'));
const aimaiBooks = new Aimai(indexedBooks);

const results3 = await aimaiBooks.search('ã ã–ã„'); // èª­ã¿ã§æ¤œç´¢
console.log(results3);
/*
[
  { item: { title: 'èµ°ã‚Œãƒ¡ãƒ­ã‚¹', author: 'å¤ªå®°æ²»' }, score: 0.xxx, refIndex: 0 },
  { item: { title: 'äººé–“å¤±æ ¼', author: 'å¤ªå®°æ²»' }, score: 0.yyy, refIndex: 1 }
]
*/
```

## âš™ï¸ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (Options)

`Aimai` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®ç¬¬äºŒå¼•æ•°ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

* `threshold`: `number` (0ã‹ã‚‰1, ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.6) - æ¤œç´¢ã®é–¾å€¤ã€‚ã‚¹ã‚³ã‚¢ãŒã“ã‚Œã‚ˆã‚Šä½ã„ã‚‚ã®ã¯çµæœã«å«ã¾ã‚Œãªã„ (1ã«è¿‘ã„ã»ã©å³å¯†)ã€‚
* `limit`: `number` - è¿”ã™çµæœã®æœ€å¤§æ•°ã€‚
* `includeScore`: `boolean` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true) - çµæœã«ã‚¹ã‚³ã‚¢ã‚’å«ã‚ã‚‹ã‹ã€‚
* `includeMatches`: `boolean` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: false) - çµæœã«ãƒãƒƒãƒã—ãŸç®‡æ‰€ã®æƒ…å ±ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆç”¨ï¼‰ã‚’å«ã‚ã‚‹ã‹ (ç¾åœ¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼)ã€‚
* `useKanaNormalization`: `boolean` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true) - **æ¤œç´¢ã‚¯ã‚¨ãƒª** ã®ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠ/åŠè§’ã‚«ãƒŠã®æ­£è¦åŒ–ã‚’è¡Œã†ã‹ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã¯ç”Ÿæˆæ™‚ã«æ­£è¦åŒ–æ¸ˆã¿ã§ã™ã€‚
* `normalizationOptions`: `object` - **æ¤œç´¢ã‚¯ã‚¨ãƒª** ã®æ­£è¦åŒ–ã«é–¢ã™ã‚‹è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (`normalizeLongVowel`, `expandIterationMark`)ã€‚
* `useRomajiSearch`: `boolean` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true) - **æ¤œç´¢ã‚¯ã‚¨ãƒª** ã®ãƒ­ãƒ¼ãƒå­—å…¥åŠ›ã‚’ã²ã‚‰ãŒãªã«å¤‰æ›ã™ã‚‹ã‹ã€‚
* `tokenizer`: `object` - **æ¤œç´¢ã‚¯ã‚¨ãƒª** ã®èª­ã¿ä»®åã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ  Kuromoji.js ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)ã€‚æŒ‡å®šã—ãªã„å ´åˆã¯å†…éƒ¨ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

## ğŸ“š API

* `Aimai(indexedData, options)`: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã€‚ç¬¬ä¸€å¼•æ•°ã«ã¯ **äº‹å‰ã«ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿** (`IndexedItem<T>[]`) ã‚’æ¸¡ã—ã¾ã™ã€‚
* `search(query)`: æ¤œç´¢ãƒ¡ã‚½ãƒƒãƒ‰ã€‚æ¤œç´¢ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã‚’å¼•æ•°ã«å–ã‚Šã¾ã™ã€‚

## ğŸ› ï¸ é–‹ç™º (Development)

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
yarn install

# TypeScriptã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« (distãƒ•ã‚©ãƒ«ãƒ€ã¸å‡ºåŠ›)
yarn build

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ (ä¾‹)
# ã¾ãš yarn build ã‚’å®Ÿè¡Œã—ã¦ãŠãã“ã¨
yarn generate:index --input=./path/to/your/data.json --output=./path/to/your/index.json

# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ (ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£ãŒå¿…è¦ã§ã™)
yarn test

# ã‚³ãƒ¼ãƒ‰æ•´å½¢ãƒ»ãƒã‚§ãƒƒã‚¯ãªã© (å¿…è¦ã«å¿œã˜ã¦è¿½åŠ )
# yarn format
# yarn lint
```

## ğŸ¤ è²¢çŒ® (Contributing)

Issue ã‚„ Pull Request ã‚’æ­“è¿ã—ã¾ã™ï¼

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ (License)

[MIT License](LICENSE)
